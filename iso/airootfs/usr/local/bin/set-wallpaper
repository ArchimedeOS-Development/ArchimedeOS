#!/bin/bash

USER=liveuser
USER_HOME=/home/$USER

export DISPLAY=:0
export XAUTHORITY=$USER_HOME/.Xauthority
export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/$(id -u $USER)/bus"

for i in {1..10}; do
    if [ -S /run/user/$(id -u $USER)/bus ]; then
        break
    fi
    sleep 1
done

/usr/bin/qdbus org.kde.plasmashell /PlasmaShell org.kde.PlasmaShell.evaluateScript \
"var allDesktops = desktops();for (i=0;i<allDesktops.length;i++){d = allDesktops[i];d.wallpaperPlugin='org.kde.image';d.currentConfigGroup = Array('Wallpaper', 'org.kde.image', 'General');d.writeConfig('Image', 'file:///usr/share/backgrounds/archimede/archimede-wallpaper.png');}"
